var canvas,$Fabric={Element:{init:function(){this.finBox=$("div.s2-main canvas#finBox")}},Temp:{FabricWidth:null,FabricHeight:null,ScaleStep:.02,ScaleNow:3,PreviewDataURL:null,ori_logo:null},Var:{init:function(){this.finBox=new fabric.Canvas("finBox"),$canvas=this.finBox,$canvas.on({"mouse:down":function(t){t.target&&(t.target.opacity=.5,$canvas.renderAll())},"mouse:up":function(t){t.target&&(t.target.opacity=1,$canvas.renderAll())},"object:moved":function(t){t.target.opacity=.5},"object:modified":function(t){t.target.opacity=1},"object:moving":function(t){var i=t.target;i.currentHeight>i.canvas.height||i.currentWidth>i.canvas.width||(i.setCoords(),(i.getBoundingRect().top<0||i.getBoundingRect().left<0)&&(i.top=Math.max(i.top,i.top-i.getBoundingRect().top),i.left=Math.max(i.left,i.left-i.getBoundingRect().left)),(i.getBoundingRect().top+i.getBoundingRect().height>i.canvas.height||i.getBoundingRect().left+i.getBoundingRect().width>i.canvas.width)&&(i.top=Math.min(i.top,i.canvas.height-i.getBoundingRect().height+i.top-i.getBoundingRect().top),i.left=Math.min(i.left,i.canvas.width-i.getBoundingRect().width+i.left-i.getBoundingRect().left)))}})}},Function:{Create:function(o,r){var t=$("div.s2-main div.finBox").width(),i=$("div.s2-main div.finBox").height();device.mobile()&&!$Fabric.Temp.FabricWidth&&($Fabric.Temp.FabricWidth=t,$Fabric.Temp.FabricHeight=i),$Fabric.Var.finBox.setHeight(t),$Fabric.Var.finBox.setWidth(i),$Fabric.Temp.FabricWidth&&($Fabric.Var.finBox.setHeight($Fabric.Temp.FabricWidth),$Fabric.Var.finBox.setWidth($Fabric.Temp.FabricHeight)),$Fabric.Var.finBox.renderAll.bind(),fabric.Image.fromURL("./asset/svg/fin-gn.svg",function(t){var i=$Fabric.Var.finBox,e=i.getWidth()/t.width,a=i.getHeight()/t.height;t.set({scaleX:e,scaleY:a,originX:"left",originY:"top"});var n=new fabric.Text(o,{fontFamily:"Noto Sans TC",left:0,top:0,fill:"#231815",fontSize:i.getWidth()/18,fontWeight:"400",selectable:!1,evented:!1});n.set("top",.98*(i.getHeight()-n.height)),n.set("left",i.getWidth()/4.2-n.width/4),i.item(0)&&i.remove(i.item(0)),i.add(n),i.setBackgroundImage(t,i.renderAll.bind(i)),$("div.s2-main div.finBox").hide(0,function(){$("div#divFabric").fadeIn("slow",function(){r(!0)})})})},UploadImage:function(c,g){var f=$Fabric.Var.finBox;fabric.Image.fromURL(c,function(t){var i=f.getWidth()/t.width,e=f.getHeight()/t.height,a=Math.min(i,e)/2.5;$Fabric.Temp.ScaleStep=a/13;var n=f.getWidth()/4,o=f.getHeight()/5,r=t.set({left:n,top:o,angle:0,hasControls:!1,hasBorders:!1}).scale(a);f.item(1)&&f.remove(f.item(1)),f.add(r).renderAll(),$Fabric.Temp.ori_logo=c,g()})},GetDataURL_Preview:function(t){$Fabric.Temp.PreviewDataURL=$Fabric.Var.finBox.toDataURL({format:"png"}),t($Fabric.Temp.PreviewDataURL)},GetDataURL_Result:function(r,c){fabric.Image.fromURL("./asset/svg/fin-w-comp.svg",function(t){var i=$Fabric.Var.finBox,e=i.getWidth()/t.width,a=i.getHeight()/t.height;t.set({scaleX:e,scaleY:a,originX:"left",originY:"top"});var n,o=new fabric.Text(r,{fontFamily:"Noto Sans TC",left:0,top:0,fill:"#fff",fontSize:i.getWidth()/18,fontWeight:"400",selectable:!1,evented:!1});o.set("top",.98*(i.getHeight()-o.height)),o.set("left",i.getWidth()/4.2-o.width/4),i.remove(i.item(0)),i.add(o),i.setBackgroundImage(t,i.renderAll.bind(i)),n=device.mobile()?$Fabric.Var.finBox.toDataURL({format:"png"}):$Fabric.Var.finBox.toDataURL({format:"png",multiplier:2}),c(n)})}},init:function(){this.Element.init(),this.Var.init()}};$(function(){});